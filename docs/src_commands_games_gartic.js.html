<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 4.0.2">
  <meta charset="utf-8">
  <title>wp-bot 4.3.2 &raquo; Source: src/commands/games/gartic.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">wp-bot 4.<wbr>3.<wbr>2</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: src/commands/games/gartic.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>import pkg from &#x27;whatsapp-web.js&#x27;;
import words from &#x27;../utils/garticwords.js&#x27;;
let listofwords &#x3D; words.split(&#x27;,&#x27;);
listofwords &#x3D; listofwords.map(word &#x3D;&gt; word.trim().toLowerCase());
function randomWord() {
    return listofwords[Math.floor(Math.random() * listofwords.length)];
}
class gartic {
    constructor(client, id) {
        this.chatid &#x3D; id;
        this.client &#x3D; client;
        this.currword &#x3D; &#x27;&#x27;;
        this.players &#x3D; [];
        this.hints &#x3D; 5;
        this.lives &#x3D; 3;
    }
    chatid;
    client;
    currword;
    players;
    hints;
    lives;
    async next_turn() {
        if (this.lives &#x3D;&#x3D; 0) {
            await this.client.sendMessage(this.chatid, &#x27;Game over!&#x27;);
            this.client.gartic &#x3D; false;
            return;
        }
        this.players.push(this.players.shift());
        const current_player &#x3D; this.players[0];
        this.currword &#x3D; randomWord();
        const media &#x3D; MessageMedia.fromFilePath(&#x27;commands/utils/white.jpg&#x27;);
        const game &#x3D; this;
        let cansend &#x3D; true;
        await this.client.sendMessage(current_player.id._serialized, media, {
            caption: &#x60;Your word is - \&#x60;${this.currword}\&#x60;\nYou have 90 seconds to draw it!&#x60;,
        });
        this.client.on(&#x27;message_create&#x27;, async function wait(msg) {
            setTimeout(async function () {
                if (cansend) {
                    cansend &#x3D; false;
                    game.client.removeListener(&#x27;message_create&#x27;, wait);
                    await game.client.sendMessage(current_player.id._serialized, &#x27;Timeout&#x27;);
                    await game.client.sendMessage(game.chatid, &#x27;they took too long to draw&#x27;);
                    game.lives--;
                    await game.next_turn();
                }
            }, 90000);
            if (!cansend) {
                return;
            }
            const chat &#x3D; await msg.getChat();
            if (chat.id._serialized !&#x3D; current_player.id._serialized) {
                return;
            }
            if (!msg.hasMedia) {
                return;
            }
            const downloaded_media &#x3D; await msg.downloadMedia();
            if (!downloaded_media?.mimetype.includes(&#x27;image&#x27;)) {
                return;
            }
            cansend &#x3D; false;
            game.client.removeListener(&#x27;message_create&#x27;, wait);
            game.client.sendMessage(game.chatid, downloaded_media, {
                caption: &#x60;Guess the drawing in 60 seconds\n${game.hints} hints left\nYou have ${game.lives} lives left&#x60;,
            });
            await game.guess_word();
        });
        await this.client.sendMessage(this.chatid, &#x60;${current_player.name || current_player.number} is drawing!&#x60;);
    }
    async guess_word() {
        const game &#x3D; this;
        let canguess &#x3D; true;
        this.client.on(&#x27;message_create&#x27;, async function wait(msg) {
            setTimeout(async function () {
                if (canguess) {
                    canguess &#x3D; false;
                    game.client.removeListener(&#x27;message_create&#x27;, wait);
                    await game.client.sendMessage(game.chatid, &#x27;times up!&#x27;);
                    game.lives--;
                    await game.next_turn();
                }
            }, 60000);
            if (!canguess) {
                return;
            }
            const chat &#x3D; await msg.getChat();
            if (chat.id._serialized !&#x3D; game.chatid) {
                return;
            }
            const user &#x3D; await msg.getContact();
            if (!game.players.find(a &#x3D;&gt; a.number &#x3D;&#x3D; user.number) ||
                user.number &#x3D;&#x3D; game.players[0].number) {
                return;
            }
            if (msg.body.toLowerCase() &#x3D;&#x3D; &#x27;ghint&#x27;) {
                const hint &#x3D; game.currword
                    .split(&#x27;&#x27;)
                    .map(l &#x3D;&gt; (l &#x3D;&#x3D; &#x27; &#x27; ? &#x27; &#x27; : &#x27;_&#x27;));
                hint.shift();
                hint.unshift(game.currword[0]);
                await msg.reply(hint.join(&#x27; &#x27;));
                game.hints--;
            }
            if (msg.body.toLowerCase() &#x3D;&#x3D; &#x27;gquit&#x27;) {
                canguess &#x3D; false;
                game.client.removeListener(&#x27;message_create&#x27;, wait);
                game.client.gartic &#x3D; false;
                await game.client.sendMessage(game.chatid, &#x27;Game stopped!&#x27;);
                return;
            }
            if (msg.body.trim().toLowerCase() &#x3D;&#x3D; game.currword &amp;amp;&amp;amp; canguess) {
                canguess &#x3D; false;
                game.client.removeListener(&#x27;message_create&#x27;, wait);
                await msg.reply(&#x27;Your guess was correct!&#x27;);
                await game.next_turn();
            }
        });
    }
}
export const name &#x3D; &#x27;gartic&#x27;;
export const args &#x3D; true;
export const aliases &#x3D; [&#x27;gc&#x27;, &#x27;ga&#x27;];
export const description &#x3D; &#x27;Play a game of gartic with someone&#x27;;
export const category &#x3D; &#x27;Games&#x27;;
const { MessageMedia } &#x3D; pkg;
/**
 * Implements a drawing and guessing game (similar to Gartic Phone) within WhatsApp.
 *
 * **Usage (within the bot):**
 * - Call &#x60;next_turn&#x60; to start the game and assign the first player to draw.
 * - The class will handle sending the word to the drawer, receiving the drawing, and prompting other players to guess.
 *
 * **User Commands:**
 * - &#x60;!gartic&#x60; or &#x60;!gc&#x60; - Starts a new Gartic-like game.
 * - &#x60;join&#x60; - Joins the ongoing game.
 * - (Drawer) Send an image as a reply to the bot&#x27;s prompt to submit the drawing.
 * - (Guessers) &#x60;{word}&#x60; - Submits a guess for the word being drawn.
 * - &#x60;ghint&#x60; - Asks for a hint about the word (reveals the first letter).
 * - &#x60;gquit&#x60; - Stops the game.
 */
export async function run(client, msg, args) {
    if (client.gartic) {
        msg.reply(&#x27;A game is currently active!&#x27;);
        return;
    }
    client.gartic &#x3D; true;
    const chat &#x3D; await msg.getChat();
    const game &#x3D; new gartic(client, chat.id._serialized);
    let started &#x3D; false;
    client.on(&#x27;message_create&#x27;, async function wait(msg) {
        const chat &#x3D; await msg.getChat();
        if (chat.id._serialized !&#x3D; game.chatid) {
            return;
        }
        if (msg.body.toLowerCase() !&#x3D; &#x27;join&#x27;) {
            return;
        }
        const user &#x3D; await msg.getContact();
        if (game.players.find(a &#x3D;&gt; a.number &#x3D;&#x3D; user.number)) {
            return;
        }
        game.players.push(user);
        await msg.react(&#x27;âœ…&#x27;);
        setTimeout(async () &#x3D;&gt; {
            if (started) {
                return;
            }
            started &#x3D; true;
            client.removeListener(&#x27;message_create&#x27;, wait);
            if (game.players.length &amp;lt; 2) {
                await client.sendMessage(game.chatid, &#x27;You need atleast 2 players to start&#x27;);
                client.gartic &#x3D; false;
                return;
            }
            game.next_turn();
        }, 15000);
    });
    await msg.reply(&#x27;A new game has started\nType &#x60;join&#x60; to join the game&#x27;);
}
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 4.0.2 on April 27, 2024.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>