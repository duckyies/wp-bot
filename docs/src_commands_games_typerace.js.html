<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 4.0.2">
  <meta charset="utf-8">
  <title>wp-bot 4.3.2 &raquo; Source: src/commands/games/typerace.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">wp-bot 4.<wbr>3.<wbr>2</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: src/commands/games/typerace.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>// @ts-ignore
import { getRandomQuote } from &#x27;everyday-fun&#x27;;
import { stringSimilarity as similarity } from &#x27;string-similarity-js&#x27;;
import pkg from &#x27;whatsapp-web.js&#x27;;
import { generate } from &#x27;text-to-image&#x27;;
import baseuser from &#x27;../../models/baseuser.js&#x27;;
const { Client, LocalAuth, MessageMedia } &#x3D; pkg;
function textGenerator() {
    let phrase &#x3D; &#x27;&#x27;;
    const quote &#x3D; getRandomQuote();
    phrase +&#x3D; &#x60;${quote.quote} - ${quote.author}&#x60;;
    return phrase;
}
export const name &#x3D; &#x27;typerace&#x27;;
export const args &#x3D; true;
export const aliases &#x3D; [&#x27;tp&#x27;, &#x27;type&#x27;, &#x27;race&#x27;];
export const description &#x3D; &#x27;Play a game of typerace to measure your typing speed&#x27;;
export const category &#x3D; &#x27;Games&#x27;;
/**
 * Implements a typing race game within WhatsApp.
 *
 * **Usage:**
 * - &#x60;!typerace&#x60; or &#x60;!tp&#x60; - Starts a new typing race.
 * - The bot will send an image with a phrase to type.
 * - Users compete to type the phrase accurately and as quickly as possible.
 */
export async function run(client, msg, args) {
    if (client.ingame) {
        msg.reply(&#x27;A game is currently active!&#x27;);
        return;
    }
    client.ingame &#x3D; true;
    const chat &#x3D; await msg.getChat();
    const phase &#x3D; textGenerator();
    const img &#x3D; await generate(phase, {
        margin: 50,
        textAlign: &#x27;center&#x27;,
        bgColor: &#x27;black&#x27;,
        textColor: &#x27;white&#x27;,
        verticalAlign: &#x27;center&#x27;,
        fontSize: 24,
        // @ts-ignore
    }).then(async function (dataUri) {
        msg.reply(&#x27;Type the following sentence as fast as you can&#x27;);
        const media &#x3D; new MessageMedia(&#x27;image/png&#x27;, dataUri.slice(22));
        await client.sendMessage(chat.id._serialized, media);
    });
    let done &#x3D; false;
    const time &#x3D; Date.now();
    client.on(&#x27;message_create&#x27;, async function trial(msg) {
        const res &#x3D; msg.body;
        let closeness &#x3D; similarity(res.toLowerCase(), phase.toLowerCase(), undefined, true);
        closeness *&#x3D; 100;
        if (closeness &gt;&#x3D; 92) {
            done &#x3D; true;
            client.ingame &#x3D; false;
            client.removeListener(&#x27;message_create&#x27;, trial);
            const user &#x3D; await msg.getContact();
            const timeTaken &#x3D; Date.now() - time;
            const user2 &#x3D; new baseuser({
                userId: user.number,
                users: client.cachedUsers,
            });
            user2.addTyperace();
            await msg.reply(&#x60;${user.name || user.number} finished first! \n\n&#x60; +
                &#x60;You took *${timeTaken / 1000}* seconds to type the phrase with a *${closeness.toFixed(2)}%* accuracy!\nYou have a raw speed of *${(((phase.length / (timeTaken / 1000)) * 60) / 5).toFixed(2)}* wpm&#x60;);
            return;
        }
        setTimeout(async () &#x3D;&gt; {
            if (done) {
                return;
            }
            client.removeListener(&#x27;message_create&#x27;, trial);
            client.ingame &#x3D; false;
            await msg.reply(&#x27;No one finished in time :(&#x27;);
        }, 60000);
    });
}
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 4.0.2 on April 27, 2024.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>