<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 4.0.2">
  <meta charset="utf-8">
  <title>wp-bot 4.3.2 &raquo; Source: src/commands/ai/wolframgpt.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">wp-bot 4.<wbr>3.<wbr>2</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: src/commands/ai/wolframgpt.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>import { HumanMessage, AIMessage } from &#x27;@langchain/core/messages&#x27;;
import { TavilySearchResults } from &#x27;@langchain/community/tools/tavily_search&#x27;;
import { pull } from &#x27;langchain/hub&#x27;;
import pkg from &#x27;whatsapp-web.js&#x27;;
import { WikipediaQueryRun } from &#x27;@langchain/community/tools/wikipedia_query_run&#x27;;
import { WolframAlphaTool } from &#x27;@langchain/community/tools/wolframalpha&#x27;;
import { ChatOpenAI } from &#x27;@langchain/openai&#x27;;
import { createOpenAIFunctionsAgent, AgentExecutor } from &#x27;langchain/agents&#x27;;
const tool2 &#x3D; new WikipediaQueryRun({
    topKResults: 3,
    maxDocContentLength: 4000,
});
const { Client, LocalAuth, MessageMedia } &#x3D; pkg;
const prompt &#x3D; await pull(&#x27;pollytheparrota2/new&#x27;);
const tool &#x3D; new WolframAlphaTool({
    appid: &#x27;J4J84J-UPVWXW4UGL&#x27;,
});
const tools &#x3D; [
    tool,
    new TavilySearchResults({
        maxResults: 1,
        apiKey: process.env.TAVILY_API_KEY,
    }),
    tool2,
];
const llm &#x3D; new ChatOpenAI({
    modelName: &#x27;gpt-3.5-turbo&#x27;,
    temperature: 0,
    openAIApiKey: process.env.OPENAI_KEY,
});
const agent &#x3D; await createOpenAIFunctionsAgent({
    llm, // @ts-ignore
    tools,
    // @ts-ignore
    prompt,
});
const history &#x3D; [];
const agentExecutor &#x3D; new AgentExecutor({
    agent, // @ts-ignore
    tools,
});
export const name &#x3D; &#x27;wolframgpt&#x27;;
export const args &#x3D; true;
export const aliases &#x3D; [&#x27;wgpt&#x27;];
export const description &#x3D; &#x27;Chat with WolframAlpha using GPT 3.5&#x27;;
export const category &#x3D; &#x27;AI&#x27;;
/**
 * Enables interaction with WolframAlpha and other tools using GPT-3.5 within WhatsApp.
 *
 * **Usage:**
 * - &#x60;!wolframgpt {query}&#x60; - Sends the query to the LangChain agent, which may use WolframAlpha or other tools to generate a response.
 *
 * **Notes:**
 * - This command requires API keys for OpenAI, Tavily, and WolframAlpha.
 */
export async function run(client, msg, args) {
    return msg.reply(&#x27;no more free credits D:&#x27;);
    if (args.length &#x3D;&#x3D; 0) {
        return;
    }
    const result1 &#x3D; await agentExecutor.invoke({
        input: args.join(&#x27; &#x27;),
        chat_history: history,
    });
    history.push(new HumanMessage(result1.input));
    history.push(new AIMessage(result1.output));
    const regex &#x3D; /(?&#x3D;\[(!\[.+?\]\(.+?\)|.+?)]\((https:\/\/[^\)]+)\))/gi;
    let str &#x3D; result1.output;
    const links &#x3D; [...str.matchAll(regex)].map(m &#x3D;&gt; ({ text: m[1], link: m[2] }));
    for (let i &#x3D; 0; i &amp;lt; links.length; i++) {
        if (!links[i].link.includes(&#x27;input?&#x27;) &amp;amp;&amp;amp;
            links[i].link.includes(&#x27;wolfram&#x27;)) {
            str &#x3D; str.replace(&#x60;[${links[i].text}](${links[i].link})&#x60;, &#x27;&#x27;);
            const media &#x3D; await MessageMedia.fromUrl(links[i].link, {
                unsafeMime: true,
            });
            await msg.reply(media);
        }
        else {
            str &#x3D; str.replace(&#x60;[${links[i].text}](${links[i].link})&#x60;, &#x60;${links[i].text} ${links[i].link}&#x60;);
        }
    }
    await msg.reply(str);
}
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 4.0.2 on April 27, 2024.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>